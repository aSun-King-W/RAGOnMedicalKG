# 项目运行说明

**作者**：医疗知识图谱问答系统——何阳  
**日期**：2025-12-20

## 前置要求

1. **Python环境**：需要Python 3.7或更高版本
2. **Neo4j数据库**：需要安装并启动Neo4j数据库

## 安装步骤

### 1. 安装Python依赖

```bash
pip install -r requirements.txt
```

### 2. 安装和配置Neo4j数据库

1. 下载并安装Neo4j Desktop或Neo4j Community Edition
   - 下载地址：https://neo4j.com/download/
   
2. 启动Neo4j数据库服务
   - 如果使用Neo4j Desktop，创建新数据库并启动
   - 如果使用Neo4j Community Edition，运行 `neo4j start`

3. 配置数据库用户名和密码
   - 默认用户名：`neo4j`
   - 首次登录需要修改密码
   - **重要**：如果使用默认用户名`neo4j`，需要修改以下文件中的连接配置：
     - `build_medicalgraph.py` 第15行
     - `answer_search.py` 第10行
   - 将用户名和密码改为您设置的Neo4j用户名和密码

### 3. 导入知识图谱数据

在Neo4j数据库启动后，运行以下命令导入数据（这可能需要几个小时）：

```bash
python build_medicalgraph.py
```

### 4. 启动LLM服务

在运行问答系统之前，需要先启动LLM服务：

```bash
python qwen7b_server.py
```

**注意**：
- 服务默认运行在端口3001
- 首次运行会下载Qwen-1.8B-Chat模型
- **保持这个终端窗口打开**

### 5. 使用问答系统（两种方式）

#### 方式1：Web可视化界面（推荐）⭐

启动服务后，直接在浏览器中访问：

```
http://127.0.0.1:3001/
```

你会看到一个美观的Web界面，可以直接输入问题并获得答案。

#### 方式2：命令行界面

在**新开一个终端窗口**，运行问答系统：

```bash
python chat_with_llm.py
```

## 当前配置

- **Neo4j连接配置**：
  - 地址：`bolt://127.0.0.1:7687`
  - 用户名：`lhy`
  - 密码：`lhy123`

**注意**：如果您的Neo4j使用不同的用户名和密码，请修改：
- `build_medicalgraph.py` 第15行
- `answer_search.py` 第10行

## 常见问题

1. **连接被拒绝**：确保Neo4j数据库已启动
2. **认证失败**：检查用户名和密码是否正确
3. **编码错误**：已修复，使用UTF-8编码读取文件

## 使用示例

启动问答系统后，可以输入以下类型的问题：

**治疗类问题**：
- "我头痛怎么办？"
- "最近老流鼻涕怎么办？"
- "失眠怎么治疗？"

**预防类问题**：
- "那头痛怎么预防？"
- "如何预防感冒？"

**症状查询**：
- "乳腺癌的症状有哪些？"

**病因查询**：
- "为什么有的人会失眠？"

**其他问题**：
- "失眠有哪些并发症？"
- "肝病要吃啥药？"
- "板蓝根颗粒能治啥病？"

等等...

---

**项目维护者**：何阳  
**最后更新**：2025-12-20  
**代码说明**：所有核心代码文件都已添加详细的中文注释，包括文件说明、函数文档、参数说明等

## 系统特点

- **RAG架构**：结合知识图谱检索和大语言模型生成
- **可解释性**：通过调试信息可以看到三元组检索过程
- **显存优化**：针对6GB GPU进行了优化，支持长文本处理
- **智能检索**：优先选择与问题直接相关的知识三元组
- **Web可视化界面**：提供美观的Web界面，无需命令行操作，直接在浏览器中使用
