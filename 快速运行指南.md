# 🚀 快速运行指南

**作者**：医疗知识图谱问答系统——何阳  
**日期**：2025-12-20

## 当前状态
❌ **Neo4j数据库未连接** - 需要先启动Neo4j数据库

## 📋 运行步骤

### 第一步：安装并启动Neo4j数据库

#### 方式一：使用Neo4j Desktop（推荐，适合初学者）

1. **下载Neo4j Desktop**
   - 访问：https://neo4j.com/download/
   - 下载Neo4j Desktop（免费）

2. **安装并启动**
   - 安装Neo4j Desktop
   - 打开Neo4j Desktop
   - 创建新项目（Project）
   - 创建新数据库（Database）
   - 设置数据库名称（如：medical_kg）
   - 设置密码（记住这个密码！）
   - 点击"Start"启动数据库

3. **获取连接信息**
   - 在Neo4j Desktop中，点击数据库的"..."菜单
   - 选择"Details"查看连接信息
   - 记录Bolt端口（通常是7687）
   - 记录用户名（通常是neo4j）和密码

#### 方式二：使用Neo4j Community Edition（适合有经验的用户）

1. **下载Neo4j Community Edition**
   - 访问：https://neo4j.com/download-center/#community

2. **安装并启动**
   ```bash
   # Windows（使用PowerShell）
   cd <neo4j安装目录>\bin
   .\neo4j.bat start
   
   # 或使用服务方式
   .\neo4j.bat install-service
   .\neo4j.bat start
   ```

3. **访问Web界面**
   - 打开浏览器访问：http://localhost:7474
   - 首次登录需要修改密码（默认用户名：neo4j，默认密码：neo4j）

---

### 第二步：配置数据库连接

根据您的Neo4j配置，修改以下两个文件中的连接信息：

#### 文件1：`build_medicalgraph.py`（第15行）
```python
self.g = Graph("bolt://127.0.0.1:7687", auth=("用户名", "密码"))
```

#### 文件2：`answer_search.py`（第11行）
```python
self.g = Graph("bolt://127.0.0.1:7687", auth=("用户名", "密码"))
```

**如果使用Neo4j Desktop的默认配置：**
- 用户名：`neo4j`
- 密码：您设置的密码
- 端口：`7687`（通常是这个）

**如果使用项目原始配置：**
- 用户名：`lhy`
- 密码：`lhy123`
- 端口：`7687`

---

### 第三步：导入知识图谱数据（首次运行必须）

在Neo4j数据库启动后，运行：

```bash
python build_medicalgraph.py
```

**注意**：
- 这个过程可能需要**几个小时**（数据量较大）
- 会显示导入进度
- 导入完成后，数据库中将有约4.4万实体和30万关系

---

### 第四步：启动LLM服务（必须）

在运行问答系统之前，需要先启动LLM服务：

```bash
python qwen7b_server.py
```

**等待看到**：
```
Running on http://127.0.0.1:3001
```

**注意**：
- 首次运行会下载Qwen-1.8B-Chat模型（约3.5GB），需要一些时间
- 模型加载完成后，服务会运行在端口3001
- **保持这个终端窗口打开**，不要关闭

---

### 第五步：使用问答系统（两种方式）

#### 方式1：Web可视化界面（推荐）⭐

启动服务后，直接在浏览器中访问：

```
http://127.0.0.1:3001/
```

**特点**：
- 🎨 美观的Web界面，无需命令行操作
- 💡 输入框直接输入问题
- 📋 提供示例问题，点击即可快速填入
- ✨ 实时显示答案，界面友好

**使用示例**：
1. 在输入框中输入："我头痛怎么办"
2. 点击"提问"按钮
3. 等待几秒钟，答案会显示在下方

#### 方式2：命令行界面

在**新开一个终端窗口**，运行：

```bash
python chat_with_llm.py
```

**使用示例**：
```
USER:我头痛怎么办
KGRAG_BOT: 根据您的问题，"头痛"最有可能是由于感冒、缺钙、压力过大等原因引起的。建议您可以服用常用的解热镇痛药，例如布洛芬缓释胶囊或者对乙酰氨基酚缓释片...

USER:那头痛怎么预防
KGRAG_BOT: 预防头痛的方法有：1. 合理饮食：多吃蔬菜水果，保持均衡营养... 2. 睡眠充足：保证充足的睡眠时间...

USER:退出
（按Ctrl+C退出）
```


## ❓ 常见问题

### Q1: 连接被拒绝怎么办？
**A**: 确保Neo4j数据库已启动
- Neo4j Desktop：检查数据库状态是否为"Running"
- Neo4j Community：运行 `neo4j status` 检查状态

### Q2: 认证失败怎么办？
**A**: 检查用户名和密码是否正确
- 默认用户名通常是 `neo4j`
- 密码是您首次登录时设置的

### Q3: 端口7687被占用怎么办？
**A**: 
- 检查Neo4j配置中的Bolt端口
- 修改连接配置中的端口号

### Q4: 数据导入很慢怎么办？
**A**: 
- 这是正常的，数据量很大（约30万关系）
- 可以等待导入完成，或者分批导入

### Q5: 如何查看Neo4j中的数据？
**A**: 
- 打开Neo4j Browser：http://localhost:7474
- 执行查询：`MATCH (n) RETURN count(n)`
- 查看图谱：`MATCH (n)-[r]->(m) RETURN n,r,m LIMIT 50`

---

## 📝 当前配置信息

- **连接地址**：`bolt://127.0.0.1:7687`
- **用户名**：`lhy`
- **密码**：`lhy123`

**如果您的Neo4j使用不同的配置，请修改上述两个文件！**

---

## 🎯 下一步操作

1. ✅ 安装并启动Neo4j数据库
2. ✅ 修改连接配置（如果需要）
3. ✅ 运行 `python 检查Neo4j连接.py` 验证连接
4. ✅ 运行 `python build_medicalgraph.py` 导入数据
5. ✅ 运行 `python qwen7b_server.py` 启动LLM服务（保持运行）
6. ✅ **方式1**：在浏览器访问 `http://127.0.0.1:3001/` 使用Web界面（推荐）
   ✅ **方式2**：运行 `python chat_with_llm.py` 使用命令行界面（新终端）

## ⚠️ 重要提示

- **必须先启动 `qwen7b_server.py`**，否则 `chat_with_llm.py` 会连接失败
- 两个程序需要在**不同的终端窗口**运行
- 如果遇到显存不足（CUDA OOM），系统会自动优化，或考虑使用CPU模式

祝您使用愉快！🎉

---

**项目维护者**：何阳  
**最后更新**：2025-12-20  
**代码说明**：所有核心代码文件都已添加详细的中文注释，便于学习和二次开发

